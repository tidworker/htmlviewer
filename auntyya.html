<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>葉阿姨語音點餐系統</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f7f7f7;
            color: #333;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #4a4a4a;
            color: white;
            padding: 10px 0;
            text-align: center;
        }
        main {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }
        h1, h2 {
            margin: 0 0 20px;
            font-weight: normal;
        }
        label {
            display: block;
            margin-bottom: 10px;
            font-size: 18px;
        }
        textarea {
            width: 96%;
            height: 80px;
            margin-bottom: 20px;
            border-radius: 5px;
            border: 1px solid #ccc;
            padding: 10px;
            font-size: 14px;
            resize: none;
            background-color: #f9f9f9;
        }
        button {
            font-size: 14px;
            padding: 10px 15px;
            background-color: #6c757d;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 5px;
        }
        #clearBtn {
            background-color: #adb5bd;
        }
        #voiceBtn.recording {
            background-color: #343a40; /* Button active color */
        }
        #completeOrderBtn {
            background-color: #6c757d;
            margin-top: 10px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 20px;
            font-size: 14px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #e9ecef;
        }
        .quantityBtn, .deleteBtn {
            font-size: 14px;
            padding: 5px 10px;
            background-color: #6c757d;
            color: #fff;
            border: none;
            border-radius: 5px;
            margin-right: 5px;
        }
        .deleteBtn {
            background-color: #adb5bd;
        }
    </style>
</head>
<body>
    <header>
        <h1>葉阿姨語音點餐系統</h1>
    </header>
    <main>
        <textarea id="inputTextArea" placeholder="點擊後開啟語音輸入..." oninput="analyzeText()"></textarea>
        <button id="voiceBtn" onclick="startVoiceInput()">開始語音輸入</button>
        <button id="clearBtn" onclick="clearText()">清除點餐</button>

        <table id="orderTable">
            <thead>
                <tr>
                    <th>餐點名稱</th>
                    <th>單價</th>
                    <th>數量</th>
                    <th>總價</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody id="orderTableBody">
            </tbody>
        </table>
        <div>總金額：<span id="totalPrice">0</span>元</div>
        <button id="completeOrderBtn" onclick="completeOrder()">完成訂單</button>
    </main>

    <script>
        var itemPrices = {
            "芝麻蔥油餅": 20,
            "蔥油餅加蛋": 30,
            "芝麻蔥油餅-加辣": 20,
            "蔥油餅加蛋-加辣": 30,
            "蛋餅加荷包蛋": 45,
            "大腸麵線": 50,
            "肉羹麵線": 50,
            "綜合麵線": 50,
            "清麵線": 40,
            "純麵線": 40,
            // 更多餐點項目...
        };

        var homophones = {
            "麵": ["面", "念", "唸"],
            "線": ["鮮"],
            // 更多同音字...
        };

        function simplifyHomophonesData(homophones) {
            var simplifiedHomophones = {};
            for (var key in homophones) {
                if (homophones.hasOwnProperty(key)) {
                    var values = homophones[key];
                    if (values.length > 1) {
                        simplifiedHomophones[key] = [values[0], values[values.length - 1]];
                    } else {
                        simplifiedHomophones[key] = values;
                    }
                }
            }
            return simplifiedHomophones;
        }

        function analyzeText() {
            var inputText = document.getElementById('inputTextArea').value;
            var matchedInfo = [];
            var totalAmount = 0;

            var simplifiedHomophones = simplifyHomophonesData(homophones);
            for (var homophone in simplifiedHomophones) {
                var homophoneArray = simplifiedHomophones[homophone];
                for (var i = 0; i < homophoneArray.length; i++) {
                    var pattern = new RegExp(homophoneArray[i], 'gi');
                    inputText = inputText.replace(pattern, homophone);
                }
            }

            for (var item in itemPrices) {
                var pattern = new RegExp(item + "\\s*(\\d+)份", 'gi');
                inputText = inputText.replace(pattern, function(match, quantity) {
                    quantity = parseInt(quantity);
                    var totalPrice = quantity * itemPrices[item];
                    addToMatchedInfo(matchedInfo, item, quantity, totalPrice);
                    totalAmount += totalPrice;
                    return "";
                });
            }

            updateOrderTable(matchedInfo, totalAmount);
        }

        function addToMatchedInfo(matchedInfo, item, quantity, totalPrice) {
            var existingItem = matchedInfo.find(element => element.name === item);
            if (existingItem) {
                existingItem.quantity += quantity;
                existingItem.totalPrice += totalPrice;
            } else {
                matchedInfo.push({
                    name: item,
                    quantity: quantity,
                    price: itemPrices[item],
                    totalPrice: totalPrice
                });
            }
        }

        function updateOrderTable(matchedInfo, totalAmount) {
            var tableBody = document.getElementById('orderTableBody');
            tableBody.innerHTML = "";
            matchedInfo.forEach(function(item) {
                var row = tableBody.insertRow();
                row.insertCell(0).textContent = item.name;
                row.insertCell(1).textContent = item.price;
                row.insertCell(2).textContent = item.quantity;
                row.insertCell(3).textContent = item.totalPrice;

                var incrementBtn = document.createElement("button");
                incrementBtn.textContent = "+";
                incrementBtn.className = "quantityBtn";
                incrementBtn.onclick = function() {
                    item.quantity++;
                    item.totalPrice += item.price;
                    updateTotalPrice(matchedInfo);
                };

                var decrementBtn = document.createElement("button");
                decrementBtn.textContent = "-";
                decrementBtn.className = "quantityBtn";
                decrementBtn.onclick = function() {
                    if (item.quantity > 1) {
                        item.quantity--;
                        item.totalPrice -= item.price;
                        updateTotalPrice(matchedInfo);
                    }
                };

                var deleteBtn = document.createElement("button");
                deleteBtn.textContent = "刪除";
                deleteBtn.className = "deleteBtn";
                deleteBtn.onclick = function() {
                    matchedInfo.splice(matchedInfo.indexOf(item), 1);
                    row.remove();
                    updateTotalPrice(matchedInfo);
                };
var actionCell = row.insertCell(4);
                actionCell.appendChild(decrementBtn);
                actionCell.appendChild(incrementBtn);
                actionConfigCell.appendChild(deleteBtn);
            });

            updateTotalPrice(matchedInfo);
        }

        function updateTotalPrice(matchedInfo) {
            var totalPriceSpan = document.getElementById('totalPrice');
            var totalAmount = matchedInfo.reduce((acc, item) => acc + item.totalPrice, 0);
            totalPriceSpan.textContent = totalAmount + '元';
        }

        function clearText() {
            document.getElementById('inputTextArea').value = "";
            document.getElementById('orderTableBody').innerHTML = "";
            updateTotalPrice([]);
        }

        function completeOrder() {
            if (matchedInfo.length === 0) {
                alert("請先添加訂單項目。");
                return;
            }
            localStorage.setItem('orders', JSON.stringify(matchedInfo));
            window.location.href = 'list.html';  // 跳轉到訂單顯示頁面
        }

        function startVoiceInput() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                alert("您的瀏覽器不支持語音識別功能，請使用支持此功能的瀏覽器。");
                return;
            }

            const recognition = new SpeechRecognition();
            recognition.lang = 'zh-TW';
            const output = document.getElementById('inputTextArea');
            var isRecording = false;

            recognition.onstart = function() {
                isRecording = true;
                document.getElementById('voiceBtn').classList.add('recording');
                document.getElementById('voiceBtn').textContent = '結束語音輸入';
            };

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                output.value += transcript;
                analyzeText();
            };

            recognition.onend = function() {
                isRecording = false;
                document.getElementById('voiceBtn').classList.remove('recording');
                document.getElementById('voiceBtn').textContent = '開始語音輸入';
            };

            recognition.onerror = function(event) {
                console.error('語音識別錯誤:', event.error);
                alert('語音識別錯誤: ' + event.error);
            };

            document.getElementById('voiceBtn').onclick = function() {
                if (isRecording) {
                    recognition.stop();
                } else {
                    recognition.start();
                }
            };
        }
    </script>
</body>
</html>